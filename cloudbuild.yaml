steps:
  - id: 'branch name'
    name: 'alpine'
    entrypoint: 'sh'
    args:
    - '-c'
    - |
       echo "*******************"
       echo "$BRANCH_NAME"
       echo "*******************"

  - id: 'tf init'
    name: 'hashicorp/terraform:1.0.0'
    entrypoint: 'sh'
    args:
    - '-c'
    - |
        terraform init

  - id: 'tf plan'
    name: 'hashicorp/terraform:1.0.0'
    entrypoint: 'sh'
    args:
    - '-c'
    - |
        terraform plan -var="name=$_NAME"

  - id: 'tf apply'
    name: 'hashicorp/terraform:1.0.0'
    entrypoint: 'sh'
    args:
    - '-c'
    - |
        if [[ "$BRANCH_NAME" == "main" ]]; then
          echo "Branch is 'main', procceding with terraform apply."
          terraform apply -var="name=$_NAME"  --auto-approve
          exit 0
        else
          echo "Branch is not 'main', skipping terraform apply."
          exit 0
        fi